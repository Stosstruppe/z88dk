1     0000              yt	equ	$ce00
2     0000              yb	equ	$cf00
3     0000              
4     0000              	org	$d000
5     0000              
6     0000  00 00 01 00 04 00 09 00 10 00 19 00 24 00 31 00 
                        powt:	dw	0, 1, 4, 9, 16, 25, 36, 49
7     0010  40 00 51 00 64 00 79 00 90 00 A9 00 C4 00 E1 00 
                        	dw	64, 81, 100, 121, 144, 169, 196, 225
8     0020  00 01 21 01 44 01 69 01 90 01 B9 01 E4 01 11 02 
                        	dw	256, 289, 324, 361, 400, 441, 484, 529
9     0030  40 02 71 02 A4 02 D9 02 10 03 49 03 84 03 C1 03 
                        	dw	576, 625, 676, 729, 784, 841, 900, 961
10    0040  00 04 41 04 84 04 C9 04 10 05 59 05 A4 05 F1 05 
                        	dw	1024, 1089, 1156, 1225, 1296, 1369, 1444, 1521
11    0050  40 06 91 06 E4 06 39 07 90 07 E9 07 44 08 A1 08 
                        	dw	1600, 1681, 1764, 1849, 1936, 2025, 2116, 2209
12    0060  00 09 61 09 C4 09 29 0A 90 0A F9 0A 64 0B D1 0B 
                        	dw	2304, 2401, 2500, 2601, 2704, 2809, 2916, 3025
13    0070  40 0C B1 0C 24 0D 99 0D 10 0E 89 0E 04 0F 81 0F 
                        	dw	3136, 3249, 3364, 3481, 3600, 3721, 3844, 3969
14    0080  00 10 81 10 04 11 89 11 10 12 99 12 24 13 B1 13 
                        	dw	4096, 4225, 4356, 4489, 4624, 4761, 4900, 5041
15    0090  40 14 D1 14 64 15 F9 15 90 16 29 17 C4 17 61 18 
                        	dw	5184, 5329, 5476, 5625, 5776, 5929, 6084, 6241
16    00A0  00 19 A1 19 44 1A E9 1A 90 1B 39 1C E4 1C 91 1D 
                        	dw	6400, 6561, 6724, 6889, 7056, 7225, 7396, 7569
17    00B0  40 1E F1 1E A4 1F 59 20 10 21 C9 21 84 22 41 23 
                        	dw	7744, 7921, 8100, 8281, 8464, 8649, 8836, 9025
18    00C0  00 24 C1 24 84 25 49 26 10 27 D9 27 A4 28 71 29 
                        	dw	9216, 9409, 9604, 9801, 10000, 10201, 10404, 10609
19    00D0  40 2A 11 2B E4 2B B9 2C 90 2D 69 2E 44 2F 21 30 
                        	dw	10816, 11025, 11236, 11449, 11664, 11881, 12100, 12321
20    00E0  00 31 E1 31 C4 32 A9 33 90 34 79 35 64 36 51 37 
                        	dw	12544, 12769, 12996, 13225, 13456, 13689, 13924, 14161
21    00F0  40 38 31 39 24 3A 19 3B 10 3C 09 3D 04 3E 01 3F 
                        	dw	14400, 14641, 14884, 15129, 15376, 15625, 15876, 16129
22    0100  00 40 01 41 04 42 09 43 10 44 19 45 24 46 31 47 
                        	dw	16384, 16641, 16900, 17161, 17424, 17689, 17956, 18225
23    0110  40 48 51 49 64 4A 79 4B 90 4C A9 4D C4 4E E1 4F 
                        	dw	18496, 18769, 19044, 19321, 19600, 19881, 20164, 20449
24    0120  00 51 21 52 44 53 69 54 90 55 B9 56 E4 57 11 59 
                        	dw	20736, 21025, 21316, 21609, 21904, 22201, 22500, 22801
25    0130  40 5A 71 5B A4 5C D9 5D 10 5F 49 60 84 61 C1 62 
                        	dw	23104, 23409, 23716, 24025, 24336, 24649, 24964, 25281
26    0140  00 64 41 65 84 66 C9 67 10 69 59 6A A4 6B F1 6C 
                        	dw	25600, 25921, 26244, 26569, 26896, 27225, 27556, 27889
27    0150  40 6E 91 6F E4 70 39 72 90 73 E9 74 44 76 A1 77 
                        	dw	28224, 28561, 28900, 29241, 29584, 29929, 30276, 30625
28    0160  00 79 61 7A C4 7B 29 7D 90 7E F9 7F 64 81 D1 82 
                        	dw	30976, 31329, 31684, 32041, 32400, 32761, 33124, 33489
29    0170  40 84 B1 85 24 87 99 88 10 8A 89 8B 04 8D 81 8E 
                        	dw	33856, 34225, 34596, 34969, 35344, 35721, 36100, 36481
30    0180  00 90 81 91 04 93 89 94 10 96 99 97 24 99 B1 9A 
                        	dw	36864, 37249, 37636, 38025, 38416, 38809, 39204, 39601
31    0190  40 9C D1 9D 64 9F F9 A0 90 A2 29 A4 C4 A5 61 A7 
                        	dw	40000, 40401, 40804, 41209, 41616, 42025, 42436, 42849
32    01A0  00 A9 A1 AA 44 AC E9 AD 90 AF 39 B1 E4 B2 91 B4 
                        	dw	43264, 43681, 44100, 44521, 44944, 45369, 45796, 46225
33    01B0  40 B6 F1 B7 A4 B9 59 BB 10 BD C9 BE 84 C0 41 C2 
                        	dw	46656, 47089, 47524, 47961, 48400, 48841, 49284, 49729
34    01C0  00 C4 C1 C5 84 C7 49 C9 10 CB D9 CC A4 CE 71 D0 
                        	dw	50176, 50625, 51076, 51529, 51984, 52441, 52900, 53361
35    01D0  40 D2 11 D4 E4 D5 B9 D7 90 D9 69 DB 44 DD 21 DF 
                        	dw	53824, 54289, 54756, 55225, 55696, 56169, 56644, 57121
36    01E0  00 E1 E1 E2 C4 E4 A9 E6 90 E8 79 EA 64 EC 51 EE 
                        	dw	57600, 58081, 58564, 59049, 59536, 60025, 60516, 61009
37    01F0  40 F0 31 F2 24 F4 19 F6 10 F8 09 FA 04 FC 01 FE 
                        	dw	61504, 62001, 62500, 63001, 63504, 64009, 64516, 65025
38    0200              
39    0200  00 01 00 01 00 01 FF 00 FF 00 FE 00 FD 00 FC 00 
                        cost:	dw	256, 256, 256, 255, 255, 254, 253, 252
40    0210  FB 00 FA 00 F8 00 F7 00 F5 00 F3 00 F1 00 EF 00 
                        	dw	251, 250, 248, 247, 245, 243, 241, 239
41    0220  ED 00 EA 00 E7 00 E5 00 E2 00 DF 00 DC 00 D8 00 
                        	dw	237, 234, 231, 229, 226, 223, 220, 216
42    0230  D5 00 D1 00 CE 00 CA 00 C6 00 C2 00 BE 00 B9 00 
                        	dw	213, 209, 206, 202, 198, 194, 190, 185
43    0240  B5 00 B1 00 AC 00 A7 00 A2 00 9D 00 98 00 93 00 
                        	dw	181, 177, 172, 167, 162, 157, 152, 147
44    0250  8E 00 89 00 84 00 7E 00 79 00 73 00 6D 00 68 00 
                        	dw	142, 137, 132, 126, 121, 115, 109, 104
45    0260  62 00 5C 00 56 00 50 00 4A 00 44 00 3E 00 38 00 
                        	dw	98, 92, 86, 80, 74, 68, 62, 56
46    0270  32 00 2C 00 26 00 1F 00 19 00 13 00 0D 00 06 00 
                        	dw	50, 44, 38, 31, 25, 19, 13, 6
47    0280  00 00 FA FF F3 FF ED FF E7 FF E1 FF DA FF D4 FF 
                        	dw	0, -6, -13, -19, -25, -31, -38, -44
48    0290  CE FF C8 FF C2 FF BC FF B6 FF B0 FF AA FF A4 FF 
                        	dw	-50, -56, -62, -68, -74, -80, -86, -92
49    02A0  9E FF 98 FF 93 FF 8D FF 87 FF 82 FF 7C FF 77 FF 
                        	dw	-98, -104, -109, -115, -121, -126, -132, -137
50    02B0  72 FF 6D FF 68 FF 63 FF 5E FF 59 FF 54 FF 4F FF 
                        	dw	-142, -147, -152, -157, -162, -167, -172, -177
51    02C0  4B FF 47 FF 42 FF 3E FF 3A FF 36 FF 32 FF 2F FF 
                        	dw	-181, -185, -190, -194, -198, -202, -206, -209
52    02D0  2B FF 28 FF 24 FF 21 FF 1E FF 1B FF 19 FF 16 FF 
                        	dw	-213, -216, -220, -223, -226, -229, -231, -234
53    02E0  13 FF 11 FF 0F FF 0D FF 0B FF 09 FF 08 FF 06 FF 
                        	dw	-237, -239, -241, -243, -245, -247, -248, -250
54    02F0  05 FF 04 FF 03 FF 02 FF 01 FF 01 FF 00 FF 00 FF 
                        	dw	-251, -252, -253, -254, -255, -255, -256, -256
55    0300  00 FF 00 FF 00 FF 01 FF 01 FF 02 FF 03 FF 04 FF 
                        	dw	-256, -256, -256, -255, -255, -254, -253, -252
56    0310  05 FF 06 FF 08 FF 09 FF 0B FF 0D FF 0F FF 11 FF 
                        	dw	-251, -250, -248, -247, -245, -243, -241, -239
57    0320  13 FF 16 FF 19 FF 1B FF 1E FF 21 FF 24 FF 28 FF 
                        	dw	-237, -234, -231, -229, -226, -223, -220, -216
58    0330  2B FF 2F FF 32 FF 36 FF 3A FF 3E FF 42 FF 47 FF 
                        	dw	-213, -209, -206, -202, -198, -194, -190, -185
59    0340  4B FF 4F FF 54 FF 59 FF 5E FF 63 FF 68 FF 6D FF 
                        	dw	-181, -177, -172, -167, -162, -157, -152, -147
60    0350  72 FF 77 FF 7C FF 82 FF 87 FF 8D FF 93 FF 98 FF 
                        	dw	-142, -137, -132, -126, -121, -115, -109, -104
61    0360  9E FF A4 FF AA FF B0 FF B6 FF BC FF C2 FF C8 FF 
                        	dw	-98, -92, -86, -80, -74, -68, -62, -56
62    0370  CE FF D4 FF DA FF E1 FF E7 FF ED FF F3 FF FA FF 
                        	dw	-50, -44, -38, -31, -25, -19, -13, -6
63    0380  00 00 06 00 0D 00 13 00 19 00 1F 00 26 00 2C 00 
                        	dw	0, 6, 13, 19, 25, 31, 38, 44
64    0390  32 00 38 00 3E 00 44 00 4A 00 50 00 56 00 5C 00 
                        	dw	50, 56, 62, 68, 74, 80, 86, 92
65    03A0  62 00 68 00 6D 00 73 00 79 00 7E 00 84 00 89 00 
                        	dw	98, 104, 109, 115, 121, 126, 132, 137
66    03B0  8E 00 93 00 98 00 9D 00 A2 00 A7 00 AC 00 B1 00 
                        	dw	142, 147, 152, 157, 162, 167, 172, 177
67    03C0  B5 00 B9 00 BE 00 C2 00 C6 00 CA 00 CE 00 D1 00 
                        	dw	181, 185, 190, 194, 198, 202, 206, 209
68    03D0  D5 00 D8 00 DC 00 DF 00 E2 00 E5 00 E7 00 EA 00 
                        	dw	213, 216, 220, 223, 226, 229, 231, 234
69    03E0  ED 00 EF 00 F1 00 F3 00 F5 00 F7 00 F8 00 FA 00 
                        	dw	237, 239, 241, 243, 245, 247, 248, 250
70    03F0  FB 00 FC 00 FD 00 FE 00 FF 00 FF 00 00 01 00 01 
                        	dw	251, 252, 253, 254, 255, 255, 256, 256
71    0400              
72    0400  01 10 02 20 04 40 08 80 
                        mask:	db	$01,$10,$02,$20,$04,$40,$08,$80
73    0408              
74    0408              	; gd408
75    0408  CD 23 05    	call	init
76    040B              
77    040B  21 00 CE    	ld	hl, yt		; yt[] = 100
78    040E  3E 64       	ld	a, 100
79    0410              L1:
80    0410  77          	ld	(hl), a
81    0411  2C          	inc	l
82    0412  C2 10 04    	jp	nz, L1
83    0415  21 00 CF    	ld	hl, yb		; yb[] = 0
84    0418  AF          	xor	a
85    0419              L2:
86    0419  77          	ld	(hl), a
87    041A  2C          	inc	l
88    041B  C2 19 04    	jp	nz, L2
89    041E              
90    041E  3E 42       	ld	a, 66
91    0420  32 3B 05    	ld	(py), a		; py = 42 + 24
92    0423  3E E8       	ld	a, -24		; for (y = -24; y <= 24; y++)
93    0425              Lout:
94    0425  32 37 05    	ld	(y), a
95    0428  6F          	ld	l, a		; y退避
96    0429  ED 44       	neg
97    042B  C6 20       	add	a, 32
98    042D  32 3A 05    	ld	(px), a		; px = 80 - 48 - y
99    0430  7D          	ld	a, l
100   0431  CD BD 04    	call	pow
101   0434  ED 53 38 05 	ld	(yy), de	; yy = pow(y, 2)
102   0438  3E E8       	ld	a, -24		; for (x = -24; x <= 24; x++)
103   043A              Lin:
104   043A  32 36 05    	ld	(x), a
105   043D  CD 5F 04    	call	calc
106   0440              
107   0440  21 3A 05    	ld	hl, px		; px += 2
108   0443  34          	inc	(hl)
109   0444  34          	inc	(hl)
110   0445  3A 36 05    	ld	a, (x)
111   0448  3C          	inc	a
112   0449  FE 19       	cp	24+1
113   044B  C2 3A 04    	jp	nz, Lin
114   044E              
115   044E  21 3B 05    	ld	hl, py		; py--
116   0451  35          	dec	(hl)
117   0452  3A 37 05    	ld	a, (y)
118   0455  3C          	inc	a
119   0456  FE 19       	cp	24+1
120   0458  C2 25 04    	jp	nz, Lout
121   045B              L9:
122   045B  76          	halt
123   045C  C3 5B 04    	jp	L9
124   045F              
125   045F              ; a: x
126   045F              calc:
127   045F  CD BD 04    	call	pow		; de = x**2
128   0462  2A 38 05    	ld	hl, (yy)
129   0465  19          	add	hl, de		; hl = x**2 + y**2
130   0466  5D          	ld	e, l		; hl *= 28
131   0467  54          	ld	d, h
132   0468  29          	add	hl, hl
133   0469  19          	add	hl, de
134   046A  29          	add	hl, hl
135   046B  19          	add	hl, de
136   046C  29          	add	hl, hl
137   046D  29          	add	hl, hl		; end
138   046E  CD CB 04    	call	sqr		; a = t
139   0471              
140   0471  4F          	ld	c, a		; c = t
141   0472  CD B5 04    	call	cos		; de = cos(t)
142   0475  6B          	ld	l, e		; hl *= 25
143   0476  62          	ld	h, d
144   0477  29          	add	hl, hl
145   0478  19          	add	hl, de
146   0479  29          	add	hl, hl
147   047A  29          	add	hl, hl
148   047B  29          	add	hl, hl
149   047C  19          	add	hl, de		; end
150   047D  E5          	push	hl		; z1 = cos(t) * 25
151   047E              
152   047E  79          	ld	a, c		; a = 3*t
153   047F  87          	add	a, a
154   0480  81          	add	a, c
155   0481  CD B5 04    	call	cos		; de = cos(3*t)
156   0484  6B          	ld	l, e		; hl *= 7.5
157   0485  62          	ld	h, d
158   0486  29          	add	hl, hl
159   0487  29          	add	hl, hl
160   0488  29          	add	hl, hl
161   0489  CB 2A       	sra	d
162   048B  CB 1B       	rr	e
163   048D  19          	add	hl, de		; end
164   048E  EB          	ex	de, hl		; z2 = cos(3*t) * 7.5
165   048F              
166   048F  ED 4B 3A 05 	ld	bc, (px)	; c = px
167   0493  60          	ld	h, b
168   0494  2E 00       	ld	l, 0
169   0496  19          	add	hl, de		; z2
170   0497  D1          	pop	de
171   0498  ED 52       	sbc	hl, de		; z1
172   049A  44          	ld	b, h		; b = py - z1 + z2
173   049B              
174   049B  1E 00       	ld	e, 0		; e = 0
175   049D  69          	ld	l, c		; c = px
176   049E  26 CE       	ld	h, yt/256	; (hl) = yt[px]
177   04A0  78          	ld	a, b
178   04A1  BE          	cp	(hl)		; if (yt[px] > py)
179   04A2  30 02       	jr	nc, calc1
180   04A4  70          	ld	(hl), b
181   04A5  1C          	inc	e
182   04A6              calc1:
183   04A6  26 CF       	ld	h, yb/256	; (hl) = yb[px]
184   04A8  7E          	ld	a, (hl)
185   04A9  B8          	cp	b		; if (yb[px] < py)
186   04AA  30 02       	jr	nc, calc2
187   04AC  70          	ld	(hl), b
188   04AD  1C          	inc	e
189   04AE              calc2:
190   04AE  7B          	ld	a, e		; if (e) pset
191   04AF  B7          	or	a
192   04B0  C8          	ret	z
193   04B1  CD FA 04    	call	pset
194   04B4  C9          	ret
195   04B5              
196   04B5              ; de = cos(a)
197   04B5              cos:
198   04B5  6F          	ld	l, a
199   04B6  26 01       	ld	h, cost/512
200   04B8  29          	add	hl, hl
201   04B9  5E          	ld	e, (hl)
202   04BA  2C          	inc	l
203   04BB  56          	ld	d, (hl)
204   04BC  C9          	ret
205   04BD              
206   04BD              ; de = pow(a, 2)
207   04BD              pow:
208   04BD  6F          	ld	l, a
209   04BE  ED 44       	neg
210   04C0  FA C4 04    	jp	m, pow1
211   04C3  6F          	ld	l, a
212   04C4              pow1:
213   04C4  26 00       	ld	h, powt/512
214   04C6  29          	add	hl, hl
215   04C7  5E          	ld	e, (hl)
216   04C8  2C          	inc	l
217   04C9  56          	ld	d, (hl)
218   04CA  C9          	ret
219   04CB              
220   04CB              ; a = sqr(hl)
221   04CB              sqr:
222   04CB  22 DD 04    	ld	(sqr_x+1), hl
223   04CE  3E 80       	ld	a, 128
224   04D0  47          	ld	b, a
225   04D1              sqr1:
226   04D1  CB 38       	srl	b		; b >>= 1
227   04D3  38 16       	jr	c, sqr3		; if (b == 0) break
228   04D5              
229   04D5  6F          	ld	l, a
230   04D6  26 00       	ld	h, powt/512
231   04D8  29          	add	hl, hl
232   04D9  5E          	ld	e, (hl)
233   04DA  2C          	inc	l
234   04DB  56          	ld	d, (hl)
235   04DC  21 00 00    sqr_x:	ld	hl, 0
236   04DF  ED 52       	sbc	hl, de		; x - powt[a]
237   04E1  30 04       	jr	nc, sqr2
238   04E3  90          	sub	b		; a -= b
239   04E4  C3 D1 04    	jp	sqr1
240   04E7              sqr2:
241   04E7  80          	add	a, b		; a += b
242   04E8  C3 D1 04    	jp	sqr1
243   04EB              sqr3:
244   04EB  6F          	ld	l, a
245   04EC  26 00       	ld	h, powt/512
246   04EE  29          	add	hl, hl
247   04EF  5E          	ld	e, (hl)
248   04F0  2C          	inc	l
249   04F1  56          	ld	d, (hl)
250   04F2  2A DD 04    	ld	hl, (sqr_x+1)
251   04F5  ED 52       	sbc	hl, de		; x - powt[a]
252   04F7  D0          	ret	nc
253   04F8  3D          	dec	a		; if (c < 0) a--
254   04F9  C9          	ret
255   04FA              
256   04FA              ; b: y (0〜99)
257   04FA              ; c; x (0〜159)
258   04FA              ; addr = $f300 + (y/4)*120 + x/2
259   04FA              ; mask = $01 << (x%2*4 + y%4)
260   04FA              pset:
261   04FA  79          	ld	a, c
262   04FB  FE A0       	cp	160
263   04FD  D0          	ret	nc		; if (x - 160 >= 0) return
264   04FE  78          	ld	a, b
265   04FF  FE 64       	cp	100
266   0501  D0          	ret	nc		; if (y - 100 >= 0) return
267   0502              
268   0502  1F          	rra
269   0503  E6 3E       	and	$3e		; a = (y/4)*2
270   0505  C6 75       	add	a, $75
271   0507  6F          	ld	l, a
272   0508  26 06       	ld	h, $06		; hl = $0675 + a
273   050A  5E          	ld	e, (hl)
274   050B  2C          	inc	l
275   050C  56          	ld	d, (hl)		; de = $f300 + (y/4)*120
276   050D  69          	ld	l, c
277   050E  CB 3D       	srl	l
278   0510  26 00       	ld	h, 0		; hl = x/2
279   0512  19          	add	hl, de		; hl = addr
280   0513              
281   0513  78          	ld	a, b
282   0514  59          	ld	e, c
283   0515  CB 1B       	rr	e		; cy = x>>1
284   0517  17          	rla			; a = y<<1 + cy
285   0518  E6 07       	and	$07		; a = yyx
286   051A  EB          	ex	de, hl
287   051B  6F          	ld	l, a
288   051C  26 04       	ld	h, mask/256
289   051E  7E          	ld	a, (hl)		; a = mask[a]
290   051F  EB          	ex	de, hl
291   0520  B6          	or	(hl)
292   0521  77          	ld	(hl), a
293   0522  C9          	ret
294   0523              
295   0523              init:
296   0523  21 30 05    	ld	hl, color
297   0526  CD 51 09    	call	$0951		; color
298   0529  01 19 50    	ld	bc, 80*256+25
299   052C  CD 3A 09    	call	$093a		; width
300   052F  C9          	ret
301   0530  30 2C 30 2C 31 00 
                        color:	db	"0,0,1", 0	; 低解像度グラフィック
302   0536              
303   0536  00          x:	ds	1
304   0537  00          y:	ds	1
305   0538  00 00       yy:	ds	2
306   053A  00          px:	ds	1
307   053B  00          py:	ds	1
308   053C              
